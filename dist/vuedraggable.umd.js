var ot=Object.defineProperty,rt=Object.defineProperties;var it=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var st=Object.prototype.hasOwnProperty,lt=Object.prototype.propertyIsEnumerable;var T=(c,l,d)=>l in c?ot(c,l,{enumerable:!0,configurable:!0,writable:!0,value:d}):c[l]=d,m=(c,l)=>{for(var d in l||(l={}))st.call(l,d)&&T(c,d,l[d]);if(R)for(var d of R(l))lt.call(l,d)&&T(c,d,l[d]);return c},p=(c,l)=>rt(c,it(l));(function(c,l){typeof exports=="object"&&typeof module!="undefined"?module.exports=l(require("sortablejs"),require("vue")):typeof define=="function"&&define.amd?define(["sortablejs","vue"],l):(c=typeof globalThis!="undefined"?globalThis:c||self,c.vuedraggable=l(c.Sortable,c.Vue))})(this,function(c,l){"use strict";function d(t){return t&&typeof t=="object"&&"default"in t?t:{default:t}}var F=d(c);function g(t){t.parentElement!==null&&t.parentElement.removeChild(t)}function C(t,e,n){const o=n===0?t.children[0]:t.children[n-1].nextSibling;t.insertBefore(e,o)}function $(t){const e=t.item.parentNode,n=e.childNodes,o=[],i=[];for(let r=0;r<n.length;r++){const s=n[r];if(s.nodeType===8){o.push(s);const a=[];i.push(a);continue}if(s.nodeType===3&&s.nextElementSibling&&s.nextElementSibling.__draggable_context){const a=s.nextElementSibling;o.push(a);const u=[s,a.nextSibling];i.push(u),r=r+2}}for(let r=0;r<o.length;r++){if(o[r].nodeType===8)continue;const a=i[r];for(let u=0;u<a.length;u++)o[r].appendChild(a[u])}e.replaceChildren(...o)}function A(t){const e=t.item.parentNode,n=e.childNodes,o=[];for(let i=0;i<n.length;i++){if(n[i].nodeType===8){o.push(n[i]);continue}const r=[].slice.call(n[i].childNodes),s=r[r.length-2],a=r[r.length-1];r.splice(r.length-2,2),n[i].replaceChildren(...r),o.push(s),o.push(n[i]),o.push(a)}e.replaceChildren(...o)}function M(){return typeof window!="undefined"?window.console:global.console}const O=M();function j(t){const e=Object.create(null);return function(o){return e[o]||(e[o]=t(o))}}const U=/-(\w)/g,k=j(t=>t.replace(U,(e,n)=>n.toUpperCase())),y=["Start","Add","Remove","Update","End"],_=["Choose","Unchoose","Sort","Filter","Clone"],E=["Move"],q=[E,y,_].flatMap(t=>t).map(t=>`on${t}`),f={manage:E,manageAndEmit:y,emit:_};function P(t){return q.indexOf(t)!==-1}const v=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","math","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rb","rp","rt","rtc","ruby","s","samp","script","section","select","slot","small","source","span","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"];function G(t){return v.includes(t)}function H(t){return["transition-group","TransitionGroup"].includes(t)}function I(t){return["id","class","role","style"].includes(t)||t.startsWith("data-")||t.startsWith("aria-")||t.startsWith("on")}function S(t){return t.reduce((e,[n,o])=>(e[n]=o,e),{})}function B({ref:t,$attrs:e,componentData:n={}}){const o=S(Object.entries(e).filter(([i,r])=>I(i)));return m(m({ref:t},o),n)}function K({$attrs:t,callBackBuilder:e}){const n=S(w(t));Object.entries(e).forEach(([i,r])=>{f[i].forEach(s=>{n[`on${s}`]=r(s)})});const o=`[data-draggable]${n.draggable||""}`;return p(m({},n),{draggable:o})}function w(t){return Object.entries(t).filter(([e,n])=>!I(e)).map(([e,n])=>[k(e),n]).filter(([e,n])=>!P(e))}const D=(t,e)=>(e&&(t=t.el.nextElementSibling),t.el?t.el:t),W=(t,e)=>t.__draggable_context=e,N=t=>t.__draggable_context,z=t=>{const e=t.el.nodeType,n=t.el.parentElement.childElementCount,o=t.el.parentElement.childNodes.length;return e===3&&n!==o};class J{constructor({nodes:{header:e,default:n,footer:o},root:i,realList:r}){this.defaultNodes=n,this.children=[...e,...n,...o],this.externalComponent=i.externalComponent,this.rootTransition=i.transition,this.tag=i.tag,this.realList=r,this.isMultiRootComponent=!1}get _isRootComponent(){return this.externalComponent||this.rootTransition}get _isMultiRootComponent(){const{defaultNodes:e}=this;if(e.length>0)return z(e[0])}render(e,n){const{tag:o,children:i,_isRootComponent:r}=this;return e(o,n,r?{default:()=>i}:i)}updated(){const{defaultNodes:e,realList:n,_isMultiRootComponent:o}=this;this.isMultiRootComponent=o,e.forEach((i,r)=>{W(D(i,this.isMultiRootComponent),{element:n[r],index:r})})}getUnderlyingVm(e){return N(e)}getVmIndexFromDomIndex(e,n){const{defaultNodes:o}=this,{length:i}=o,r=n.children,s=r.item(e);if(s===null)return i;const a=N(s);if(a)return a.index;if(i===0)return 0;const u=D(o[0]),x=[...r].findIndex(h=>h===u);return e<x?0:i}}function Q(t,e){const n=t[e];return n?n():[]}function X({$slots:t,realList:e,getKey:n}){const o=e||[],[i,r]=["header","footer"].map(u=>Q(t,u)),{item:s}=t;if(!s)throw new Error("draggable element must have an item slot");const a=o.flatMap((u,x)=>s({element:u,index:x}).map(h=>(h.key=n(u),h.props=p(m({},h.props||{}),{"data-draggable":!0}),h)));if(a.length!==o.length)throw new Error("Item slot must have only one child");return{header:i,footer:r,default:a}}function Y(t){const e=H(t),n=!G(t)&&!e;return{transition:e,externalComponent:n,tag:n?l.resolveComponent(t):e?l.TransitionGroup:t}}function Z({$slots:t,tag:e,realList:n,getKey:o}){const i=X({$slots:t,realList:n,getKey:o}),r=Y(e);return new J({nodes:i,root:r,realList:n})}function L(t,e){l.nextTick(()=>this.$emit(t.toLowerCase(),e))}function V(t){return(e,n)=>{if(this.realList!==null)return this[`onDrag${t}`](e,n)}}function tt(t){const e=V.call(this,t);return(n,o)=>{e.call(this,n,o),L.call(this,t,n)}}let b=null;const et={list:{type:Array,required:!1,default:null},modelValue:{type:Array,required:!1,default:null},itemKey:{type:[String,Function],required:!0},clone:{type:Function,default:t=>t},tag:{type:String,default:"div"},move:{type:Function,default:null},componentData:{type:Object,required:!1,default:null}},nt=["update:modelValue","change",...[...f.manageAndEmit,...f.emit].map(t=>t.toLowerCase())];return l.defineComponent({name:"draggable",inheritAttrs:!1,props:et,emits:nt,data(){return{error:!1}},render(){try{this.error=!1;const{$slots:t,$attrs:e,tag:n,componentData:o,realList:i,getKey:r}=this,s=Z({$slots:t,tag:n,realList:i,getKey:r});this.componentStructure=s;const a=B({ref:"el",$attrs:e,componentData:o});return s.render(l.h,a)}catch(t){return this.error=!0,l.h("pre",{style:{color:"red"}},t.stack)}},created(){this.list!==null&&this.modelValue!==null&&O.error("modelValue and list props are mutually exclusive! Please set one or another.")},mounted(){if(this.error)return;const{$attrs:t,componentStructure:e}=this;e.updated();const n=K({$attrs:t,callBackBuilder:{manageAndEmit:r=>tt.call(this,r),emit:r=>L.bind(this,r),manage:r=>V.call(this,r)}});let o=this.$refs.el;(e.externalComponent||e.rootTransition)&&(o=o.$el);const i=o.nodeType===1?o:o.parentElement;this._sortable=new F.default(i,n),this.targetDomElement=i,i.__draggable_component__=this},updated(){this.componentStructure.updated()},beforeUnmount(){this._sortable!==void 0&&this._sortable.destroy()},computed:{realList(){const{list:t}=this;return t||this.modelValue},getKey(){const{itemKey:t}=this;return typeof t=="function"?t:e=>e[t]}},watch:{$attrs:{handler(t){const{_sortable:e}=this;!e||w(t).forEach(([n,o])=>{e.option(n,o)})},deep:!0}},methods:{getUnderlyingVm(t){return this.componentStructure.getUnderlyingVm(t)||null},getUnderlyingPotencialDraggableComponent(t){return t.__draggable_component__},emitChanges(t){l.nextTick(()=>this.$emit("change",t))},alterList(t){if(this.list){t(this.list);return}const e=[...this.modelValue];t(e),this.$emit("update:modelValue",e)},spliceList(){const t=e=>e.splice(...arguments);this.alterList(t)},updatePosition(t,e){const n=o=>o.splice(e,0,o.splice(t,1)[0]);this.alterList(n)},getRelatedContextFromMoveEvent({to:t,related:e}){const n=this.getUnderlyingPotencialDraggableComponent(t);if(!n)return{component:n};const o=n.realList,i={list:o,component:n};if(t!==e&&o){const r=n.getUnderlyingVm(e)||{};return m(m({},r),i)}return i},getVmIndexFromDomIndex(t){return this.componentStructure.getVmIndexFromDomIndex(t,this.targetDomElement)},onDragStart(t){this.componentStructure.isMultiRootComponent&&$(t),this.context=this.getUnderlyingVm(t.item),t.item._underlying_vm_=this.clone(this.context.element),b=t.item},onDragAdd(t){const e=t.item._underlying_vm_;if(e===void 0)return;g(t.item);const n=this.getVmIndexFromDomIndex(t.newIndex);this.spliceList(n,0,e);const o={element:e,newIndex:n};this.emitChanges({added:o})},onDragRemove(t){if(C(this.$el,t.item,t.oldIndex),t.pullMode==="clone"){g(t.clone);return}const{index:e,element:n}=this.context;this.spliceList(e,1);const o={element:n,oldIndex:e};this.emitChanges({removed:o})},onDragUpdate(t){g(t.item),C(t.from,t.item,t.oldIndex);const e=this.context.index,n=this.getVmIndexFromDomIndex(t.newIndex);this.updatePosition(e,n);const o={element:this.context.element,oldIndex:e,newIndex:n};this.emitChanges({moved:o})},computeFutureIndex(t,e){if(!t.element)return 0;const n=[...e.to.children].filter(s=>s.style.display!=="none"),o=n.indexOf(e.related),i=t.component.getVmIndexFromDomIndex(o);return n.indexOf(b)!==-1||!e.willInsertAfter?i:i+1},onDragMove(t,e){const{move:n,realList:o}=this;if(!n||!o)return!0;const i=this.getRelatedContextFromMoveEvent(t),r=this.computeFutureIndex(i,t),s=p(m({},this.context),{futureIndex:r}),a=p(m({},t),{relatedContext:i,draggedContext:s});return n(a,e)},onDragEnd(t){this.componentStructure.isMultiRootComponent&&A(t),b=null}}})});
